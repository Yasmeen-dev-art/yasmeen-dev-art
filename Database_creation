--Welcome to my SQL Portfolio!!
--Topic 1: Database Creation; PROJECT-  Blog Database

--STEP 1: CREATE TABLES:

CREATE TABLE Authors (
    author_id SERIAL PRIMARY KEY,         -- PK: Unique identifier for the author (SERIAL is common for auto-increment)
    username VARCHAR(50) UNIQUE NOT NULL, -- Must be unique (for login)
    email VARCHAR(100) UNIQUE NOT NULL,   -- Must be unique
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    join_date DATE DEFAULT CURRENT_DATE
);

CREATE TABLE Posts (
    post_id SERIAL PRIMARY KEY,
    author_id INT NOT NULL,                                                        -- FK: Links to the Authors table
    title VARCHAR(255) UNIQUE NOT NULL,
    content TEXT NOT NULL,                                                         -- TEXT is good for long articles
    publication_date TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    is_published BOOLEAN DEFAULT FALSE,

    -- Define the Foreign Key Constraint
    CONSTRAINT fk_author
        FOREIGN KEY(author_id)
        REFERENCES Authors(author_id)
        ON DELETE CASCADE                                                           -- If an author is deleted, delete all their posts
);

CREATE TABLE Comments (
    comment_id SERIAL PRIMARY KEY,
    post_id INT NOT NULL,                                                            -- FK: Links to the Posts table
    author_id INT,                                                                   -- FK: Optional, for registered users (NULL for guests)
    comment_text VARCHAR(500) NOT NULL,
    comment_date TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    -- Define Foreign Key Constraints
    CONSTRAINT fk_post
        FOREIGN KEY(post_id)
        REFERENCES Posts(post_id)
        ON DELETE CASCADE, -- If a post is deleted, delete all its comments
        
    CONSTRAINT fk_comment_author
        FOREIGN KEY(author_id)
        REFERENCES Authors(author_id)
        ON DELETE SET NULL                                                           -- If a registered author is deleted, their comments remain (attributed to NULL/Guest)
);

CREATE TABLE Tags (
    tag_id SERIAL PRIMARY KEY,
    tag_name VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE Post_Tags (
    post_id INT NOT NULL,
    tag_id INT NOT NULL,

    -- Define Foreign Key Constraints
    CONSTRAINT fk_post_tag
        FOREIGN KEY(post_id)
        REFERENCES Posts(post_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_tag_post
        FOREIGN KEY(tag_id)
        REFERENCES Tags(tag_id)
        ON DELETE CASCADE,

    -- This ensures the combination of the two IDs is unique (prevents adding the same tag twice to one post)
    PRIMARY KEY (post_id, tag_id)
);


--Inserting values:

INSERT INTO Authors (username, email, first_name, last_name, join_date) VALUES
('code_maven', 'alex@blog.com', 'Alex', 'Johnson', '2023-01-15'),
('data_digger', 'maria@blog.com', 'Maria', 'Garcia', '2023-03-22'),
('front_end_fan', 'sam@blog.com', 'Sam', 'Kruger', '2023-07-10');


INSERT INTO Posts (author_id, title, content, publication_date, is_published) VALUES
(1, 'The Joy of SQL Joins: A Beginner''s Guide', 'Content about INNER, LEFT, RIGHT, and FULL joins...', '2023-11-01 10:00:00', TRUE),
(2, 'Mastering Python Data Structures in 10 Minutes', 'A deep dive into lists, dictionaries, and sets...', '2023-11-05 14:30:00', TRUE),
(1, 'Database Normalization: The Good, The Bad, and The 3NF', 'Explaining 1NF, 2NF, and 3NF with examples.', '2023-10-25 08:00:00', TRUE),
(3, '10 Essential CSS Tricks for Responsive Design', 'Tips on Flexbox, Grid, and media queries.', '2023-11-10 12:00:00', TRUE),
(3, 'Future of JavaScript Frameworks', 'A look at React, Vue, and Svelte.', '2023-11-11 15:00:00', FALSE); -- Unpublished post

INSERT INTO Tags (tag_name) VALUES
('SQL'),
('PostgreSQL'),
('Python'),
('Data Science'),
('Web Development'),
('CSS'),
('JavaScript');

INSERT INTO Post_Tags (post_id, tag_id) VALUES
(1, 1), -- Post 1 (SQL Joins) -> Tag 1 (SQL)
(1, 2), -- Post 1 (SQL Joins) -> Tag 2 (PostgreSQL)
(2, 3), -- Post 2 (Python Data) -> Tag 3 (Python)
(2, 4), -- Post 2 (Python Data) -> Tag 4 (Data Science)
(3, 1), -- Post 3 (Normalization) -> Tag 1 (SQL)
(3, 2), -- Post 3 (Normalization) -> Tag 2 (PostgreSQL)
(4, 5), -- Post 4 (CSS Tricks) -> Tag 5 (Web Development)
(4, 6), -- Post 4 (CSS Tricks) -> Tag 6 (CSS)
(5, 5), -- Post 5 (JS Frameworks) -> Tag 5 (Web Development)
(5, 7); -- Post 5 (JS Frameworks) -> Tag 7 (JavaScript)            

INSERT INTO Comments (post_id, author_id, comment_text) VALUES
(1, 2, 'Great explanation of FULL OUTER JOIN! Very clear.'), -- Maria comments on Alex's post
(1, NULL, 'As a newbie, this helped me a lot with my homework!'), -- Guest comment
(3, 1, 'I think 3NF is key for most business apps.'), -- Alex comments on his own post
(4, 3, 'My favorite is the new CSS Subgrid feature!'), -- Sam comments on his own post
(2, NULL, 'Do you have an article coming up on Pandas?'); -- Guest comment
